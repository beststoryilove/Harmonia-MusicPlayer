<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="description" content="Harmonia - 介绍页 · 带智能跳转功能" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Harmonia · 让音乐触手可及</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* ========== 原有介绍页样式（完全保留） ========== */
    @font-face {
      src: url(fonts/PingFangSC-Regular.woff2);
      font-family: "PingFangSC-Regular";
    }
    @font-face {
      src: url(fonts/sf-pro-display_regular.woff2);
      font-family: "SFPro-Regular";
    }
    @font-face {
      src: url(fonts/PingFangSC-Semibold.woff2);
      font-family: "PingFangSC-Semibold";
    }
    @font-face {
      src: url(fonts/sf-pro-display_semibold.woff2);
      font-family: "SFPro-Semibold";
    }

    :root {
      --bg-dark: #000;
      --text-dark: #fff;
      --text-secondary-dark: #8e8e93;
      --primary-color: #ff2d55;
      --primary-gradient: linear-gradient(135deg, #ff2d55, #ff375f);
      --ios-glass-dark: rgba(20, 20, 20, 0.65);
      --ios-border-dark: rgba(255, 255, 255, 0.08);
      --border-radius-lg: 20px;
      --border-radius-md: 12px;
      --shadow-dark: 0 8px 30px rgba(0, 0, 0, 0.6);
      --transition-speed: 0.3s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      font-family: "SFPro-Regular", "PingFangSC-Regular", -apple-system, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: var(--bg-dark);
      color: var(--text-dark);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
      position: relative;
    }

    .am-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      background: radial-gradient(circle at 20% 30%, #1a1a1e, #000000);
      filter: blur(28px) brightness(0.6);
      transform: scale(1.1);
    }
    .am-background::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(2px);
    }

    .intro-wrapper {
      max-width: 1280px;
      margin: 0 auto;
      padding: 2rem 2rem 3rem;
      position: relative;
      z-index: 10;
    }

    /* 品牌胶囊、hero、特性网格等（略，完全保留原有设计） */
    .intro-dynamic-brand { display: flex; justify-content: center; margin-bottom: 3rem; }
    .brand-island { background: rgba(20,20,20,0.68); backdrop-filter: blur(18px) saturate(180%); border: 1px solid rgba(255,255,255,0.12); border-radius: 40px; padding: 12px 30px; display: inline-flex; align-items: center; gap: 16px; box-shadow: 0 18px 45px rgba(0,0,0,0.7); }
    .brand-indicator { width: 10px; height: 10px; background: radial-gradient(circle at 30% 30%, #ff8a96, #ff2d55); border-radius: 50%; box-shadow: 0 0 15px var(--primary-color); animation: pulseGlow 2s infinite; }
    @keyframes pulseGlow { 0%,100%{opacity:0.9;transform:scale(1);} 50%{opacity:0.5;transform:scale(0.8);} }
    .brand-text { font-size: 1.2rem; font-weight: 600; color: rgba(255,255,255,0.95); }
    .brand-version { font-size: 0.8rem; background: rgba(255,45,85,0.25); padding: 4px 12px; border-radius: 60px; color: rgba(255,255,255,0.8); border: 0.5px solid rgba(255,45,85,0.5); }

    .intro-hero { text-align: center; margin: 4rem 0 3rem; }
    .intro-hero h1 { font-size: 5rem; font-weight: 700; font-family: "SFPro-Semibold", sans-serif; background: linear-gradient(145deg, #ffffff, #ffe3e8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 40px rgba(255,45,85,0.3); margin-bottom: 0.5rem; }
    .intro-subhead { font-size: 1.6rem; color: rgba(255,255,255,0.65); }
    .intro-description { font-size: 1.2rem; color: var(--text-secondary-dark); max-width: 600px; margin: 1.5rem auto; background: rgba(255,255,255,0.05); padding: 1.2rem 2rem; border-radius: 60px; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.06); }

    .intro-actions { display: flex; gap: 20px; justify-content: center; margin: 2.5rem 0 4rem; }
    .btn { padding: 16px 40px; border-radius: 999px; font-weight: 600; font-size: 1.1rem; transition: all 0.25s; border: none; display: inline-flex; align-items: center; gap: 12px; backdrop-filter: blur(18px); text-decoration: none; }
    .btn-primary { background: var(--primary-gradient); color: white; box-shadow: 0 15px 30px rgba(255,45,85,0.3); }
    .btn-primary:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 22px 45px rgba(255,45,85,0.45); }
    .btn-secondary { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: rgba(255,255,255,0.9); }
    .btn-secondary:hover { background: rgba(255,255,255,0.15); transform: translateY(-4px); }

    .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: 28px; margin: 5rem 0; }
    .feature-card { background: var(--ios-glass-dark); backdrop-filter: blur(22px) saturate(180%); border: 1px solid var(--ios-border-dark); border-radius: 28px; padding: 2rem 1.8rem; transition: all 0.25s; box-shadow: 0 15px 40px rgba(0,0,0,0.45); }
    .feature-card:hover { background: rgba(35,35,40,0.75); border-color: rgba(255,45,85,0.25); transform: translateY(-6px); }
    .feature-icon { font-size: 2.4rem; color: var(--primary-color); margin-bottom: 1.3rem; background: rgba(255,45,85,0.1); width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border-radius: 18px; border: 1px solid rgba(255,45,85,0.25); }

    .showcase-section { display: flex; flex-wrap: wrap; gap: 35px; margin: 6rem 0; align-items: center; background: rgba(25,25,30,0.35); backdrop-filter: blur(20px); border-radius: 48px; padding: 3rem; border: 1px solid rgba(255,255,255,0.06); }
    .showcase-album { flex: 0 0 220px; height: 220px; border-radius: 16px; background: linear-gradient(145deg, #3a3a44, #1e1e22); display: flex; align-items: center; justify-content: center; box-shadow: 0 30px 60px rgba(0,0,0,0.6); }
    .showcase-album i { font-size: 6rem; color: rgba(255,255,255,0.2); }
    .showcase-lyrics { flex: 1; min-width: 260px; }
    .lyric-line { font-size: 1.8rem; font-weight: 600; color: rgba(255,255,255,0.25); margin-bottom: 0.8rem; }
    .lyric-highlight { color: white; text-shadow: 0 0 10px rgba(255,45,85,0.6); }
    .word-demo { display: inline-block; position: relative; white-space: pre; color: rgba(255,255,255,0.35); }
    .word-demo::after { content: attr(data-text); position: absolute; left: 0; top: 0; width: 70%; overflow: hidden; white-space: pre; color: white; }
    .island-mock { background: rgba(20,20,20,0.7); backdrop-filter: blur(18px); border-radius: 50px; padding: 0.9rem 1.8rem; display: inline-flex; align-items: center; gap: 20px; border: 1px solid rgba(255,255,255,0.1); margin-top: 1.5rem; }

    .tech-badge { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin: 3rem 0; }
    .badge { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 100px; padding: 8px 22px; font-size: 0.9rem; color: rgba(255,255,255,0.8); backdrop-filter: blur(10px); }

    .intro-footer { margin-top: 6rem; padding-top: 3rem; border-top: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; flex-wrap: wrap; align-items: center; color: rgba(255,255,255,0.5); }
    .footer-links a { color: rgba(255,255,255,0.7); text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: color 0.2s; }
    .footer-links a:hover { color: var(--primary-color); }

    @media (max-width: 768px) {
      .intro-wrapper { padding: 1rem 1.5rem; }
      .intro-hero h1 { font-size: 3.6rem; }
    }

    /* ===== 新增：全局毛玻璃模态框 ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.65);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-speed) ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal-card {
      background: rgba(22, 22, 25, 0.85);
      backdrop-filter: blur(28px) saturate(180%);
      -webkit-backdrop-filter: blur(28px) saturate(180%);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 32px;
      padding: 32px;
      max-width: 480px;
      width: 90%;
      box-shadow: 0 35px 90px rgba(0,0,0,0.75);
      color: white;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-card {
      transform: translateY(0);
    }
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .modal-body {
      font-size: 16px;
      line-height: 1.6;
      color: rgba(255,255,255,0.9);
      margin-bottom: 28px;
    }
    .modal-actions {
      display: flex;
      gap: 16px;
      justify-content: flex-end;
    }
    .modal-btn {
      padding: 12px 28px;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      backdrop-filter: blur(12px);
    }
    .btn-confirm {
      background: var(--primary-gradient);
      color: white;
      box-shadow: 0 10px 25px rgba(255,45,85,0.35);
    }
    .btn-cancel {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      color: rgba(255,255,255,0.9);
    }
    .modal-btn:hover {
      transform: translateY(-2px);
    }

    /* 倒计时进度条模块 */
    .countdown-container {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(18, 18, 20, 0.85);
      backdrop-filter: blur(28px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 60px;
      padding: 18px 32px;
      display: flex;
      align-items: center;
      gap: 28px;
      z-index: 10001;
      box-shadow: 0 20px 50px rgba(0,0,0,0.7);
      transition: opacity 0.3s;
    }
    .countdown-text {
      display: flex;
      flex-direction: column;
    }
    .countdown-label {
      font-size: 14px;
      color: rgba(255,255,255,0.6);
      margin-bottom: 4px;
    }
    .progress-bar-bg {
      width: 200px;
      height: 8px;
      background: rgba(255,255,255,0.12);
      border-radius: 12px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 100%;
      background: var(--primary-gradient);
      border-radius: 12px;
      transition: width 0.1s linear;
    }
    .stop-btn {
      background: rgba(255,45,85,0.2);
      border: 1px solid rgba(255,45,85,0.3);
      color: white;
      padding: 10px 26px;
      border-radius: 40px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .stop-btn:hover {
      background: rgba(255,45,85,0.35);
      border-color: rgba(255,45,85,0.6);
    }
    @media (max-width: 600px) {
      .countdown-container {
        flex-direction: column;
        width: 90%;
        padding: 20px;
        gap: 16px;
      }
      .progress-bar-bg { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="am-background"></div>

  <!-- 原有介绍页内容（简略展示，完整内容请见原始文件） -->
  <div class="intro-wrapper">
    <div class="intro-dynamic-brand">
      <div class="brand-island">
        <span class="brand-indicator"></span>
        <span class="brand-text">Harmonia</span>
        <span class="brand-version">v2.0</span>
      </div>
    </div>
    <div class="intro-hero">
      <h1>Harmonia</h1>
      <div class="intro-subhead">歌词跃然灵动 · 音乐浑然一体</div>
      <div class="intro-description">
        <i class="fas fa-music" style="color: #ff2d55; margin-right: 8px;"></i>
        一个美观易用的在线音乐播放器 — 歌词显示、播放列表、多主题。
      </div>
      <div class="intro-actions">
        <a class="btn btn-primary" href="https://harmoniamusicplayer.dpdns.org/" target="_blank">
          <i class="fas fa-rocket"></i> 快速直达
        </a>
        <a class="btn btn-secondary" onclick="alert('核心特性：逐字歌词｜灵动岛搜索｜拖拽排序｜桌面歌词｜AI翻译');">
          <i class="fas fa-magic"></i> 探索功能
        </a>
      </div>
    </div>
    <!-- 特性网格、展示区等略，保持与原介绍页一致 -->
    <div class="features-grid">
      <!-- Apple Music 风格歌词 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-align-left"></i></div>
        <h3>Apple Music 歌词</h3>
        <p>沉浸式滚动歌词，高亮行优雅居中，支持点击跳转。适配移动全屏歌词模式，营造纯粹聆听氛围。</p>
      </div>
      <!-- 灵动岛全局搜索 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-magnifying-glass"></i></div>
        <h3>灵动岛 · 搜索</h3>
        <p>点击顶部灵动岛即展开完整搜索面板，支持分页、一键加歌、收藏。交互细腻，效率与美感并存。</p>
      </div>
      <!-- 逐字歌词 (KTV) -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-microchip"></i></div>
        <h3>逐字歌词 · 精准高亮</h3>
        <p>优先从网易云获取 yrc 逐字歌词，单字/词渐进填充，媲美专业K歌应用。无逐字歌词时智能回退。</p>
      </div>
      <!-- 智能翻译 + GLM 联动 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-language"></i></div>
        <h3>AI 歌词翻译</h3>
        <p>集成 GLM-4-Flashx 大模型，智能检测外语歌词，仅翻译无译版或强制翻译，API 令牌自由配置。</p>
      </div>
      <!-- 播放列表 & 拖拽排序 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-grip-vertical"></i></div>
        <h3>拖拽排序 · 智能管理</h3>
        <p>侧拉抽屉内支持自定义拖拽排序（该功能目前已移除）、A-Z 快速整理，三种视图（播放列表/收藏/历史），全键盘高效操作。</p>
      </div>
      <!-- 桌面歌词 & 多屏协同 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-desktop"></i></div>
        <h3>桌面歌词 · WebSocket</h3>
        <p>通过 WebSocket 连接本地歌词工具，实时发送歌词与进度。打造专属听歌环境，跨屏体验。</p>
      </div>
      <!-- 主题切换 · 深色/浅色 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-palette"></i></div>
        <h3>双主题 · 随境而变</h3>
        <p>细腻的深色/浅色模式，适配 Apple 风格毛玻璃。所有卡片、按钮、滑块同步变换，保护双眼。</p>
      </div>
      <!-- 专辑封面3D & 模糊背景 -->
      <div class="feature-card">
        <div class="feature-icon"><i class="fas fa-image"></i></div>
        <h3>封面3D · 氛围背景</h3>
        <p>专辑封面支持鼠标悬停 3D 旋转，背景实时提取封面色彩并生成模糊层，沉浸感拉满。</p>
      </div>
    </div>

    <!-- 技术徽章 / 特性标签 -->
    <div class="tech-badge">
      <span class="badge"><i class="fas fa-bolt"></i> 网易云音乐源</span>
      <span class="badge"><i class="fas fa-cubes"></i> 内置CORS代理轮询</span>
      <span class="badge"><i class="fas fa-arrows-spread"></i> 播放顺序(循环/随机/单曲)</span>
      <span class="badge"><i class="fas fa-volume"></i> 音量记忆</span>
      <span class="badge"><i class="fas fa-share-nodes"></i> 歌单导入/导出</span>
      <span class="badge"><i class="fas fa-floppy-disk"></i> 壁纸保存</span>
    </div>

     <!-- ===== 全新页脚：GitHub 仓库 + 在线直达 ===== -->
    <div class="intro-footer">
      <div class="footer-copyright">
        <i class="far fa-copyright" style="font-size: 0.9rem;"></i> 2026 Harmonia · 让音乐触手可即
      </div>
      <div class="footer-links">
        <!-- GitHub 仓库 -->
        <a href="https://github.com/beststoryilove/Harmonia-MusicPlayer" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-github"></i> GitHub
        </a>
        <!-- 在线直达链接（与按钮相同） -->
        <a href="https://harmoniamusicplayer.dpdns.org/main.html" target="_blank" rel="noopener noreferrer">
          <i class="fas fa-external-link-alt"></i> 在线直达
        </a>
        <a href="https://harmoniamusicplayer.dpdns.org/tiaokuan.html" target="_blank" rel="noopener noreferrer">
          <i class="fa fa-address-book"></i> 隐私政策与用户条款
        </a>
      </div>
    </div>
  </div>

  <!-- ===== 模态框：首次访问询问 ===== -->
  <div class="modal-overlay" id="firstVisitModal">
    <div class="modal-card">
      <div class="modal-title">
        <i class="fas fa-bolt" style="color: #ff2d55;"></i> 欢迎使用 Harmonia
      </div>
      <div class="modal-body">
        您正在访问 Harmonia 介绍页。<br><br>
        <strong>后续访问该域名时是否直接跳转至播放器主体？</strong><br>
        （您可在每次跳转前取消）
      </div>
      <div class="modal-actions">
        <button class="modal-btn btn-cancel" id="firstVisitCancel">暂不设置</button>
        <button class="modal-btn btn-confirm" id="firstVisitConfirm">同意并继续</button>
      </div>
    </div>
  </div>

  <!-- ===== 模态框：取消跳转后二次询问 ===== -->
  <div class="modal-overlay" id="cancelRedirectModal">
    <div class="modal-card">
      <div class="modal-title">
        <i class="fas fa-question-circle" style="color: #ff2d55;"></i> 您取消了自动跳转
      </div>
      <div class="modal-body">
        您刚刚取消了自动跳转。<br><br>
        <strong>后续访问该域名时是否直接跳转至播放器主体？</strong>
      </div>
      <div class="modal-actions">
        <button class="modal-btn btn-cancel" id="cancelRedirectNo">不跳转</button>
        <button class="modal-btn btn-confirm" id="cancelRedirectYes">启用跳转</button>
      </div>
    </div>
  </div>

  <!-- ===== 倒计时跳转提示 ===== -->
  <div id="countdownPanel" style="display: none;">
    <div class="countdown-container">
      <div class="countdown-text">
        <span class="countdown-label"><i class="fas fa-hourglass-half"></i> 5秒后自动跳转至播放器</span>
        <div class="progress-bar-bg">
          <div class="progress-fill" id="countdownProgress" style="width: 100%;"></div>
        </div>
      </div>
      <button class="stop-btn" id="stopRedirectBtn">
        <i class="fas fa-stop-circle"></i> 停止跳转
      </button>
    </div>
  </div>

  <script>
    (function() {
      'use strict';

      // ---------- 常量与配置 ----------
      const REDIRECT_KEY = 'harmonia_redirect_preference'; // true = 启用自动跳转
      const TARGET_URL = '/main.html';                     // 跳转目标（相对于域名根）
      const COUNTDOWN_SECONDS = 5;                         // 倒计时秒数

      // ---------- DOM 元素 ----------
      const firstVisitModal = document.getElementById('firstVisitModal');
      const cancelModal = document.getElementById('cancelRedirectModal');
      const countdownPanel = document.getElementById('countdownPanel');
      const countdownProgress = document.getElementById('countdownProgress');
      const stopBtn = document.getElementById('stopRedirectBtn');

      // ---------- 工具函数 ----------
      function getPreference() {
        const val = localStorage.getItem(REDIRECT_KEY);
        if (val === null) return null;        // 未设置
        return val === 'true';                // 布尔值
      }

      function setPreference(enable) {
        localStorage.setItem(REDIRECT_KEY, enable.toString());
      }

      function clearPreference() {
        localStorage.removeItem(REDIRECT_KEY);
      }

      // 显示模态框（通用）
      function showModal(modal) {
        if (modal) modal.classList.add('active');
      }
      function hideModal(modal) {
        if (modal) modal.classList.remove('active');
      }

      // ---------- 首次访问弹窗逻辑 ----------
      function showFirstVisitModal() {
        showModal(firstVisitModal);
      }

      // 首次访问弹窗：同意
      document.getElementById('firstVisitConfirm').addEventListener('click', function() {
        setPreference(true);          // 启用后续自动跳转
        hideModal(firstVisitModal);
        // 本次不跳转，直接关闭
      });

      // 首次访问弹窗：取消
      document.getElementById('firstVisitCancel').addEventListener('click', function() {
        clearPreference();           // 清除偏好（等同于未设置）
        hideModal(firstVisitModal);
      });

      // 点击模态框背景关闭（视为取消）
      firstVisitModal.addEventListener('click', function(e) {
        if (e.target === firstVisitModal) {
          clearPreference();
          hideModal(firstVisitModal);
        }
      });

      // ---------- 倒计时跳转逻辑 ----------
      let countdownTimer = null;
      let remainingSeconds = COUNTDOWN_SECONDS;
      let isStopped = false;

      function startRedirectCountdown() {
        // 如果已经显示倒计时，先清除旧的
        if (countdownTimer) clearInterval(countdownTimer);
        isStopped = false;
        remainingSeconds = COUNTDOWN_SECONDS;
        countdownProgress.style.width = '100%';
        countdownPanel.style.display = 'block';

        countdownTimer = setInterval(() => {
          if (isStopped) return;
          remainingSeconds -= 0.1; // 每100ms减0.1
          const percent = (remainingSeconds / COUNTDOWN_SECONDS) * 100;
          countdownProgress.style.width = Math.max(percent, 0) + '%';

          // 更新文字
          const label = document.querySelector('.countdown-label');
          if (label) {
            label.innerHTML = `<i class="fas fa-hourglass-half"></i> ${Math.ceil(remainingSeconds)}秒后自动跳转至播放器`;
          }

          if (remainingSeconds <= 0) {
            clearInterval(countdownTimer);
            countdownTimer = null;
            // 执行跳转
            window.location.href = TARGET_URL;
          }
        }, 100);
      }

      // 停止跳转
      function stopRedirectAndAsk() {
        isStopped = true;
        clearInterval(countdownTimer);
        countdownTimer = null;
        countdownPanel.style.display = 'none';

        // 显示二次确认弹窗
        showModal(cancelModal);
      }

      // 绑定停止按钮
      stopBtn.addEventListener('click', stopRedirectAndAsk);

      // ---------- 二次确认弹窗 ----------
      // 用户选择「启用跳转」
      document.getElementById('cancelRedirectYes').addEventListener('click', function() {
        setPreference(true);          // 设置后续自动跳转
        hideModal(cancelModal);
        // 本次不跳转，已经取消了，所以直接关闭
      });

      // 用户选择「不跳转」
      document.getElementById('cancelRedirectNo').addEventListener('click', function() {
        clearPreference();           // 彻底关闭自动跳转功能
        hideModal(cancelModal);
      });

      // 点击背景关闭（视为不跳转）
      cancelModal.addEventListener('click', function(e) {
        if (e.target === cancelModal) {
          clearPreference();
          hideModal(cancelModal);
        }
      });

      // ---------- 页面初始化：根据存储状态决定行为 ----------
      function init() {
        const pref = getPreference();

        // 情况1：从未设置过偏好 → 首次访问弹窗
        if (pref === null) {
          showFirstVisitModal();
          return;
        }

        // 情况2：已设置启用自动跳转 (pref === true)
        if (pref === true) {
          // 后续访问：启动倒计时跳转
          startRedirectCountdown();
          return;
        }

        // 情况3：已设置禁用自动跳转 (pref === false) → 什么也不做，安静展示介绍页
        // （用户之前明确拒绝过）
      }

      // 确保在DOM加载完成后执行
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }

      // ---------- 保留原介绍页的逐字歌词动画（与原脚本兼容）----------
      const demoSpans = document.querySelectorAll('.word-demo');
      if (demoSpans.length) {
        let progress = 0;
        setInterval(() => {
          progress = (progress + 7) % 100;
          demoSpans.forEach(span => {
            span.style.setProperty('--p', progress + '%');
          });
        }, 300);
      }

    })();
  </script>
</body>
</html>
